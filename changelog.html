<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="view-transition" content="same-origin" />
    <meta
      name="description"
      content="KvoLib Changelog - Recent updates and commits"
    />
    <title>Changelog - KvoLib</title>
    <script src="/assets/js/head-loader.js"></script>
    <style>
      .changelog-container {
        max-width: 900px;
        margin: 0 auto;
      }

      .date-group {
        margin-bottom: 24px;
      }

      .date-header {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 12px 0;
        color: rgba(255, 255, 255, 0.7);
        font-size: 0.875rem;
        font-weight: 500;
      }

      .date-header i {
        color: rgba(255, 255, 255, 0.4);
      }

      .commits-list {
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 8px;
        overflow: hidden;
      }

      .commit-item {
        display: flex;
        align-items: flex-start;
        justify-content: space-between;
        gap: 16px;
        padding: 16px 20px;
        background: rgba(255, 255, 255, 0.02);
        border-bottom: 1px solid rgba(255, 255, 255, 0.06);
        transition: background 0.15s ease;
      }

      .commit-item:last-child {
        border-bottom: none;
      }

      .commit-item:hover {
        background: rgba(255, 255, 255, 0.04);
      }

      .commit-info {
        flex: 1;
        min-width: 0;
      }

      .commit-message {
        font-size: 0.9375rem;
        color: #fff;
        margin-bottom: 6px;
        line-height: 1.4;
      }

      .commit-message a {
        color: inherit;
        text-decoration: none;
      }

      .commit-message a:hover {
        color: #58a6ff;
        text-decoration: underline;
      }

      .commit-meta {
        display: flex;
        align-items: center;
        gap: 6px;
        font-size: 0.8rem;
        color: rgba(255, 255, 255, 0.5);
      }

      .commit-meta img {
        width: 16px;
        height: 16px;
        border-radius: 50%;
      }

      .commit-meta a {
        color: rgba(255, 255, 255, 0.7);
        text-decoration: none;
      }

      .commit-meta a:hover {
        color: #58a6ff;
        text-decoration: underline;
      }

      .commit-actions {
        display: flex;
        align-items: center;
        gap: 8px;
        flex-shrink: 0;
      }

      .commit-sha {
        font-family: "SF Mono", Monaco, Consolas, monospace;
        font-size: 0.75rem;
        color: #58a6ff;
        background: rgba(88, 166, 255, 0.1);
        padding: 4px 10px;
        border-radius: 6px;
        text-decoration: none;
        border: 1px solid rgba(88, 166, 255, 0.2);
      }

      .commit-sha:hover {
        background: rgba(88, 166, 255, 0.15);
      }

      .commit-btn {
        width: 28px;
        height: 28px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: transparent;
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 6px;
        color: rgba(255, 255, 255, 0.5);
        cursor: pointer;
        transition: all 0.15s ease;
        font-size: 0.75rem;
      }

      .commit-btn:hover {
        background: rgba(255, 255, 255, 0.05);
        color: #fff;
        border-color: rgba(255, 255, 255, 0.2);
      }

      .loading-state {
        text-align: center;
        padding: 60px 20px;
        color: rgba(255, 255, 255, 0.5);
      }

      .loading-spinner {
        width: 32px;
        height: 32px;
        border: 3px solid rgba(255, 255, 255, 0.1);
        border-top-color: #58a6ff;
        border-radius: 50%;
        animation: spin 0.8s linear infinite;
        margin: 0 auto 16px;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      .error-state {
        text-align: center;
        padding: 40px 20px;
        color: #f85149;
        background: rgba(248, 81, 73, 0.1);
        border-radius: 8px;
        border: 1px solid rgba(248, 81, 73, 0.2);
      }

      .github-link {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        margin-top: 32px;
        padding: 10px 20px;
        background: transparent;
        border: 1px solid rgba(255, 255, 255, 0.15);
        border-radius: 6px;
        color: rgba(255, 255, 255, 0.8);
        text-decoration: none;
        font-size: 0.875rem;
        transition: all 0.15s ease;
      }

      .github-link:hover {
        background: rgba(255, 255, 255, 0.05);
        border-color: rgba(255, 255, 255, 0.25);
        color: #fff;
      }
    </style>
  </head>
  <body>
    <script src="/assets/js/navbar-loader.js"></script>

    <section class="page-header" data-aos="fade-down">
      <div class="container">
        <span class="section-badge">Updates</span>
        <h1 class="page-title">Changelog</h1>
        <p class="page-description">Recent commits and updates from GitHub.</p>
      </div>
    </section>

    <section class="components-page">
      <div class="container">
        <div id="changelog-container" class="changelog-container">
          <div class="loading-state">
            <div class="loading-spinner"></div>
            <p>Loading commits from GitHub...</p>
          </div>
        </div>

        <div style="text-align: center">
          <a
            href="https://github.com/Kvoryz/KvoLib/commits/main"
            target="_blank"
            class="github-link"
          >
            <i class="fab fa-github"></i>
            View all commits on GitHub
          </a>
        </div>
      </div>
    </section>

    <div data-include="assets/layout/footer.html"></div>
    <script src="/assets/js/scripts-loader.js"></script>

    <script>
      async function fetchCommits() {
        const container = document.getElementById("changelog-container");

        try {
          const response = await fetch(
            "https://api.github.com/repos/Kvoryz/KvoLib/commits?per_page=30"
          );

          if (!response.ok) throw new Error("Failed to fetch commits");

          const commits = await response.json();

          if (commits.length === 0) {
            container.innerHTML =
              '<p style="text-align: center; color: rgba(255,255,255,0.5);">No commits found.</p>';
            return;
          }

          // Group commits by date
          const grouped = {};
          commits.forEach((commit) => {
            const date = new Date(commit.commit.author.date).toLocaleDateString(
              "en-US",
              {
                month: "short",
                day: "numeric",
                year: "numeric",
              }
            );
            if (!grouped[date]) grouped[date] = [];
            grouped[date].push(commit);
          });

          let html = "";
          for (const [date, dateCommits] of Object.entries(grouped)) {
            html += `
              <div class="date-group" data-aos="fade-up">
                <div class="date-header">
                  <i class="fas fa-code-commit"></i>
                  Commits on ${date}
                </div>
                <div class="commits-list">
                  ${dateCommits
                    .map(
                      (commit) => `
                    <div class="commit-item">
                      <div class="commit-info">
                        <div class="commit-message">
                          <a href="${
                            commit.html_url
                          }" target="_blank">${escapeHtml(
                        commit.commit.message.split("\n")[0]
                      )}</a>
                        </div>
                        <div class="commit-meta">
                          <img src="${
                            commit.author?.avatar_url ||
                            "https://github.com/identicons/default.png"
                          }" alt="">
                          <a href="https://github.com/${
                            commit.author?.login || ""
                          }" target="_blank">${
                        commit.author?.login || commit.commit.author.name
                      }</a>
                          <span>committed ${formatRelativeTime(
                            commit.commit.author.date
                          )}</span>
                        </div>
                      </div>
                      <div class="commit-actions">
                        <a href="${
                          commit.html_url
                        }" target="_blank" class="commit-sha">${commit.sha.substring(
                        0,
                        7
                      )}</a>
                        <button class="commit-btn" onclick="copyToClipboard('${
                          commit.sha
                        }')" title="Copy full SHA">
                          <i class="fas fa-copy"></i>
                        </button>
                        <a href="https://github.com/Kvoryz/KvoLib/tree/${
                          commit.sha
                        }" target="_blank" class="commit-btn" title="Browse repository at this point">
                          <i class="fas fa-code"></i>
                        </a>
                      </div>
                    </div>
                  `
                    )
                    .join("")}
                </div>
              </div>
            `;
          }

          container.innerHTML = html;

          if (typeof AOS !== "undefined") AOS.refresh();
        } catch (error) {
          container.innerHTML = `
            <div class="error-state">
              <i class="fas fa-exclamation-circle" style="font-size: 1.5rem; margin-bottom: 12px;"></i>
              <p>Failed to load commits. Please try again later.</p>
            </div>
          `;
        }
      }

      function escapeHtml(text) {
        const div = document.createElement("div");
        div.textContent = text;
        return div.innerHTML;
      }

      function formatRelativeTime(dateString) {
        const date = new Date(dateString);
        const now = new Date();
        const diff = now - date;

        const minutes = Math.floor(diff / 60000);
        const hours = Math.floor(diff / 3600000);
        const days = Math.floor(diff / 86400000);

        if (minutes < 1) return "just now";
        if (minutes < 60)
          return `${minutes} minute${minutes > 1 ? "s" : ""} ago`;
        if (hours < 24) return `${hours} hour${hours > 1 ? "s" : ""} ago`;
        if (days === 1) return "yesterday";
        if (days < 7) return `${days} days ago`;

        return date.toLocaleDateString("en-US", {
          month: "short",
          day: "numeric",
        });
      }

      function copyToClipboard(text) {
        navigator.clipboard.writeText(text);
      }

      fetchCommits();
    </script>
  </body>
</html>
